<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Música</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <div class="container">
        <h1>Reproductor de Música</h1>

        <!-- Elemento de audio -->
        <audio id="audioPlayer" controls>
            Tu navegador no soporta el elemento de audio.
        </audio>

        <!-- Botón para mostrar/ocultar lista de canciones -->
        <button onclick="togglePlaylist()">Lista de Canciones</button>

        <!-- Lista de canciones (oculta por defecto) -->
        <ul id="playlist" class="playlist" style="display: none;"></ul>

        <!-- Contenedor para efecto visual de sonido -->
        <div id="visualizer" class="visualizer"></div>

        <!-- Controles adicionales -->
        <div class="controls">
            <button onclick="previousTrack()"><i class="fas fa-backward"></i></button>
            <button onclick="togglePlayPause()" id="playPauseButton"><i class="fas fa-play"></i></button>
            <button onclick="nextTrack()"><i class="fas fa-forward"></i></button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1" onchange="setVolume(this.value)">
        </div>
    </div>
    </div>

    <script>
        const audioPlayer = document.getElementById('audioPlayer');
        const playlistt = document.getElementById('playlist');

        const storedPlaylist = localStorage.getItem('playlist');
        let playlist = [];

        if (storedPlaylist) {
            playlist = JSON.parse(storedPlaylist);
        } else {
            // Si no hay lista en localStorage, usar la lista predeterminada
            playlist = [
                { name: "Canción 1", url: "cancion1.mp3" },
                { name: "Canción 2", url: "cancion2.mp3" },
                { name: "Canción 3", url: "cancion3.mp3" }
            ];
            localStorage.setItem('playlist', JSON.stringify(playlist));
        }

        const playlistElement = document.getElementById('playlist');

        playlist.forEach((song, index) => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = `audio/${song.url}`;
            link.textContent = song.name;
            listItem.appendChild(link);
            playlistElement.appendChild(listItem);

            // Asignar evento click para reproducir la canción correspondiente
            link.addEventListener('click', (event) => {
                event.preventDefault(); // Evitar que el enlace redireccione
                playTrack(index);
            });
        });


        let currentTrack = 0;

        function playTrack(trackIndex) {
            const trackUrl = playlist[trackIndex].url;
            audioPlayer.src = trackUrl;
            audioPlayer.play();
            currentTrack = trackIndex;

            const visualizer = document.getElementById('visualizer');
            visualizer.style.animationPlayState = 'running';
        }

        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        }

        function nextTrack() {
            currentTrack = (currentTrack + 1) % playlist.length;
            playTrack(currentTrack);
        }

        function previousTrack() {
            currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
            playTrack(currentTrack);
        }

        function setVolume(volume) {
            audioPlayer.volume = volume;
        }

        function togglePlaylist() {
            const playlistElement = document.getElementById('playlist');
            playlistElement.style.display = (playlistElement.style.display === 'none') ? 'block' : 'none';
        }

        function stopTrack() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;

            // Detener efecto visual
            const visualizer = document.getElementById('visualizer');
            visualizer.style.animationPlayState = 'paused';
        }

        // Reproducir la primera canción al cargar la página
        playTrack(currentTrack);

        // Controlar la reproducción cuando se hace clic en la lista de canciones
        /*Array.from(playlist.children).forEach((item, index) => {
            item.addEventListener('click', () => {
                playTrack(index);
            });
        });*/
    </script>
</body>

</html>